<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ALBIS — ALBIS WEB VIEW</title>
    <link rel="icon" type="image/png" href="ressources/albis_512x512.png" />
    <link rel="shortcut icon" href="ressources/albis_512x512.png" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="canvas-first">
    <div class="page">
      <div class="chrome">
        <div class="menu-bar">
          <div class="menu-left">
            <button class="menu-item is-active" data-menu="file">File</button>
            <button class="menu-item" data-menu="settings">Settings</button>
            <button class="menu-item" data-menu="help">Help</button>
          </div>
          <div class="menu-right">ALBIS</div>
        </div>
        <div class="menu-dropdown" id="menu-dropdown" aria-hidden="true">
          <div class="dropdown-panel" data-menu="file">
            <button class="dropdown-item" data-action="new-window">
              <span>New Window</span>
              <span class="shortcut">⌘N</span>
            </button>
            <button class="dropdown-item" data-action="open">
              <span>Open…</span>
              <span class="shortcut">⌘O</span>
            </button>
            <button class="dropdown-item" data-action="close-file">
              <span>Close File</span>
              <span class="shortcut">⌘W</span>
            </button>
            <div class="dropdown-item dropdown-submenu-parent">
              <span>Save As…</span>
              <span class="submenu-caret">▶</span>
              <div class="dropdown-submenu">
                <button class="dropdown-item" data-action="save-full">
                  <span>Full Image</span>
                  <span class="shortcut">⌘S</span>
                </button>
                <button class="dropdown-item" data-action="save-visible">
                  <span>Visible Area</span>
                  <span class="shortcut">⇧⌘S</span>
                </button>
                <button class="dropdown-item" data-action="save-window">
                  <span>Viewer Window</span>
                  <span class="shortcut">⌥⌘S</span>
                </button>
              </div>
            </div>
            <div class="dropdown-item dropdown-submenu-parent">
              <span>Export</span>
              <span class="submenu-caret">▶</span>
              <div class="dropdown-submenu">
                <button class="dropdown-item" data-action="export-full">
                  <span>Full Image</span>
                  <span class="shortcut">⌘E</span>
                </button>
                <button class="dropdown-item" data-action="export-visible">
                  <span>Visible Area</span>
                  <span class="shortcut">⇧⌘E</span>
                </button>
                <button class="dropdown-item" data-action="export-window">
                  <span>Viewer Window</span>
                  <span class="shortcut">⌥⌘E</span>
                </button>
              </div>
            </div>
          </div>
          <div class="dropdown-panel" data-menu="settings">
            <button class="dropdown-item" data-action="settings-open">
              <span>Preferences…</span>
              <span class="shortcut">⌘,</span>
            </button>
            <button class="dropdown-item" data-action="command-palette">
              <span>Command Palette…</span>
              <span class="shortcut">⌘K</span>
            </button>
            <button class="dropdown-item" data-action="toggle-fullscreen">
              <span>Toggle Full Screen</span>
              <span class="shortcut">F</span>
            </button>
          </div>
          <div class="dropdown-panel" data-menu="help">
            <button class="dropdown-item" data-action="help-docs">
              <span>Documentation</span>
              <span class="shortcut">F1</span>
            </button>
            <button class="dropdown-item" data-action="help-log">
              <span>Open Log File</span>
            </button>
            <button class="dropdown-item" data-action="help-about">
              <span>About</span>
            </button>
          </div>
        </div>
        <div class="toolbar">
          <div class="toolbar-main">
            <div class="toolbar-buttons">
              <div class="toolbar-cluster toolbar-cluster-transport">
                <button class="tool-btn" id="btn-prev" aria-label="Previous frame">◀</button>
                <button class="tool-btn" id="btn-next" aria-label="Next frame">▶</button>
                <button class="tool-btn" id="btn-play" aria-label="Play">⏯</button>
              </div>
                <div class="toolbar-cluster toolbar-cluster-frame">
                  <div class="toolbar-frame is-hidden" id="toolbar-frame-wrap">
                    <input id="frame-range" type="range" min="1" max="1" value="1" />
                  </div>
                  <div class="toolbar-frame-index is-hidden" id="toolbar-frame-index-wrap">
                    <input id="frame-index" type="number" min="1" value="1" />
                  </div>
                  <div class="toolbar-playback is-hidden" id="toolbar-playback-wrap">
                    <button
                      class="tool-btn toolbar-playback-btn"
                      id="toolbar-playback-toggle"
                      type="button"
                      aria-label="Playback options"
                      aria-expanded="false"
                      aria-haspopup="true"
                      aria-controls="toolbar-playback-popover"
                    >
                      Playback ▾
                    </button>
                    <div class="toolbar-playback-popover" id="toolbar-playback-popover" aria-hidden="true">
                      <div class="toolbar-step is-hidden" id="toolbar-step-wrap">
                        <select id="frame-step" aria-label="Frame step">
                          <option value="1" selected>Step 1</option>
                          <option value="10">Step 10</option>
                          <option value="100">Step 100</option>
                          <option value="1000">Step 1000</option>
                        </select>
                      </div>
                      <div class="toolbar-fps is-hidden" id="toolbar-fps-wrap">
                        <select id="fps-select" aria-label="Playback speed">
                          <option value="1" selected>1 fps</option>
                          <option value="2">2 fps</option>
                          <option value="3">3 fps</option>
                          <option value="4">4 fps</option>
                          <option value="5">5 fps</option>
                          <option value="6">6 fps</option>
                          <option value="7">7 fps</option>
                          <option value="8">8 fps</option>
                          <option value="9">9 fps</option>
                          <option value="10">10 fps</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="toolbar-threshold is-hidden" id="toolbar-threshold-wrap">
                    <select id="toolbar-threshold" aria-label="Threshold"></select>
                  </div>
                </div>
            </div>
            <div class="toolbar-path" id="toolbar-path">No file loaded</div>
          </div>
          <div class="toolbar-right">
            <button class="tool-btn tool-btn-compact" id="fullscreen-toggle" aria-label="Toggle full screen">⛶</button>
            <div class="toolbar-more" id="toolbar-more-wrap">
              <button
                class="tool-btn toolbar-more-toggle"
                id="toolbar-more-toggle"
                type="button"
                aria-label="More controls"
                aria-expanded="false"
                aria-haspopup="true"
                aria-controls="toolbar-more-popover"
              >
                More ▾
              </button>
              <div class="toolbar-more-popover" id="toolbar-more-popover" aria-hidden="true">
                <label class="field toolbar-more-field" id="toolbar-more-step-field">
                  <span>Step</span>
                  <select id="toolbar-more-step" aria-label="Frame step">
                    <option value="1" selected>Step 1</option>
                    <option value="10">Step 10</option>
                    <option value="100">Step 100</option>
                    <option value="1000">Step 1000</option>
                  </select>
                </label>
                <label class="field toolbar-more-field" id="toolbar-more-fps-field">
                  <span>Playback speed</span>
                  <select id="toolbar-more-fps" aria-label="Playback speed">
                    <option value="1" selected>1 fps</option>
                    <option value="2">2 fps</option>
                    <option value="3">3 fps</option>
                    <option value="4">4 fps</option>
                    <option value="5">5 fps</option>
                    <option value="6">6 fps</option>
                    <option value="7">7 fps</option>
                    <option value="8">8 fps</option>
                    <option value="9">9 fps</option>
                    <option value="10">10 fps</option>
                  </select>
                </label>
                <label class="field toolbar-more-field is-hidden" id="toolbar-more-threshold-field">
                  <span>Threshold</span>
                  <select id="toolbar-more-threshold" aria-label="Threshold"></select>
                </label>
                <div class="toolbar-more-actions">
                  <button class="tool-btn" id="toolbar-more-panel-toggle" type="button" aria-label="Open side menu">
                    Open side menu
                  </button>
                  <button class="tool-btn" id="toolbar-more-fullscreen" type="button" aria-label="Toggle full screen">
                    Full screen
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="upload-bar" id="upload-bar" aria-hidden="true">
          <div class="upload-bar-fill" id="upload-bar-fill"></div>
          <div class="upload-bar-text" id="upload-bar-text">Uploading 0%</div>
        </div>
      </div>

      <div class="app">
        <main class="viewer">
          <div class="canvas-shell">
            <div class="canvas-wrap" id="canvas-wrap">
              <canvas id="image-canvas"></canvas>
              <div class="loading" id="loading">Loading frame…</div>
            </div>
            <canvas id="resolution-overlay"></canvas>
            <canvas id="peak-overlay"></canvas>
            <canvas id="pixel-overlay"></canvas>
            <canvas id="roi-overlay"></canvas>
            <div class="splash" id="splash">
              <canvas id="splash-canvas"></canvas>
              <div class="splash-art" aria-hidden="true"></div>
              <div class="splash-label">
                <div class="splash-title">ALBIS</div>
                <div class="splash-sub" id="splash-status">Starting backend...</div>
                <div class="splash-actions">
                  <button class="btn btn-primary splash-open-file" id="splash-open-file" type="button">
                    Open file
                  </button>
                  <div class="splash-hint">Use File -> Open... to load your first dataset.</div>
                </div>
              </div>
            </div>
            <div class="cursor-overlay" id="cursor-overlay" aria-hidden="true"></div>
            <div class="viewer-footer">
              <div class="viewer-footer-main">
                <span class="viewer-footer-pill viewer-footer-status" id="status" role="status" aria-live="polite">Idle</span>
                <span class="viewer-footer-pill" id="footer-file">No file</span>
                <span class="viewer-footer-pill" id="footer-zoom">Zoom 1.0x</span>
              </div>
              <div class="viewer-footer-side">
                <div class="backend-badge" id="backend-badge" role="status" aria-live="polite" aria-hidden="true">SERVER</div>
                <div class="live-badge" id="live-badge" role="status" aria-live="polite" aria-hidden="true">LIVE</div>
                <span class="viewer-footer-pill viewer-footer-version" id="footer-version-frontend">FE v-</span>
                <span class="viewer-footer-pill viewer-footer-version" id="footer-version-backend">BE v-</span>
                <a
                  class="viewer-footer-link"
                  id="footer-github"
                  href="https://github.com/SaschaAndresGrimm/ALBIS"
                  target="_blank"
                  rel="noopener noreferrer"
                  >
                  <svg class="viewer-footer-github-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path
                      d="M12 .5C5.73.5.5 5.73.5 12c0 5.08 3.29 9.38 7.86 10.9.58.1.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54-.52-1.33-1.28-1.68-1.28-1.68-1.05-.72.08-.71.08-.71 1.16.08 1.77 1.2 1.77 1.2 1.03 1.77 2.7 1.26 3.36.96.1-.75.4-1.26.73-1.55-2.55-.29-5.23-1.27-5.23-5.67 0-1.25.45-2.27 1.19-3.07-.12-.29-.52-1.45.11-3.03 0 0 .97-.31 3.17 1.18a11 11 0 0 1 5.78 0c2.2-1.49 3.17-1.18 3.17-1.18.63 1.58.23 2.74.11 3.03.74.8 1.19 1.82 1.19 3.07 0 4.41-2.69 5.38-5.25 5.66.41.36.77 1.07.77 2.15 0 1.55-.01 2.8-.01 3.18 0 .31.21.67.8.56A11.5 11.5 0 0 0 23.5 12C23.5 5.73 18.27.5 12 .5Z"
                    ></path>
                  </svg>
                  <span>GitHub</span>
                </a
                >
              </div>
            </div>
          </div>
        </main>

        <aside class="panel is-collapsed" id="side-panel">
          <div class="panel-sheet-handle" id="panel-sheet-handle" aria-hidden="true">
            <span class="panel-sheet-grip"></span>
          </div>
          <div class="panel-resizer" id="panel-resizer" aria-hidden="true"></div>
          <button
            class="panel-fab"
            id="panel-fab"
            type="button"
            aria-label="Open panel"
            aria-expanded="false"
            aria-controls="side-panel"
            title="Open side menu (M)"
          >
            Open menu ▾
          </button>
          <div class="panel-body">
          <div class="panel-tabs" role="tablist">
            <button class="panel-tab is-active" data-panel-tab="view" type="button">View</button>
            <button class="panel-tab" data-panel-tab="data" type="button">Data</button>
            <button class="panel-tab" data-panel-tab="analysis" type="button">Overlay</button>
          </div>

          <div class="panel-tab-content is-active" data-panel-tab="view">
            <section class="panel-section" data-section="view">
              <button class="section-title" type="button" data-section-toggle>
                View
                <span class="section-chevron">▾</span>
              </button>
              <div class="thumb-view">
                <canvas id="overview-canvas"></canvas>
              </div>
              <div class="zoom-controls">
                <div class="field zoom-row">
                  <span>Zoom</span>
                  <div class="inline">
                    <input id="zoom-range" type="range" min="0.02" max="50" step="0.01" value="1" />
                    <div id="zoom-value" class="pill">1.0x</div>
                  </div>
                </div>
                <div class="check-grid">
                  <label class="checkbox">
                    <input id="pixel-label-toggle" type="checkbox" checked />
                    Show Pixel Values
                  </label>
                  <label class="checkbox">
                    <input type="checkbox" id="mask-toggle" disabled />
                    Mask pixels
                  </label>
                  <label class="checkbox">
                    <input type="checkbox" id="mask-saturated-toggle" disabled />
                    Mask saturated
                  </label>
                </div>
                <button id="reset-view" class="btn">Fit to Window</button>
              </div>
              <div class="view-color-controls">
                <label class="field">
                  <span>Color Map</span>
                  <div class="inline color-map-row">
                    <select id="colormap-select">
                      <option value="heat">Heat</option>
                      <option value="albulaHdr" selected>ALBULA HDR</option>
                      <option value="albisHdr">High Dynamic Range</option>
                      <option value="gray">Grey Scale</option>
                      <option value="viridis">Rainbow (Viridis)</option>
                      <option value="magma">Magma</option>
                      <option value="inferno">Inferno</option>
                      <option value="cividis">Cividis</option>
                      <option value="turbo">Turbo</option>
                    </select>
                    <label class="checkbox">
                      <input type="checkbox" id="invert-color" />
                      Invert Color
                    </label>
                  </div>
                </label>
              </div>
            </section>

            <section class="panel-section" data-section="histogram">
              <button class="section-title" type="button" data-section-toggle>
                Histogram
                <span class="section-chevron">▾</span>
              </button>
              <div class="histogram">
                <canvas id="hist-canvas" width="800" height="50"></canvas>
                <canvas id="hist-colorbar" width="800" height="16"></canvas>
                <div class="hist-tooltip" id="hist-tooltip" aria-hidden="true"></div>
              </div>
              <div class="range-actions range-actions-compact">
                <button id="auto-contrast" class="btn">Auto Contrast</button>
                <label class="checkbox">
                  <input id="auto-scale" type="checkbox" checked />
                  Auto
                </label>
                <label class="range-inline compact">
                  <span>BG</span>
                  <input id="min-input" type="number" step="1" />
                </label>
                <label class="range-inline compact">
                  <span>FG</span>
                  <input id="max-input" type="number" step="1" />
                </label>
              </div>
            </section>

            <section class="panel-section meta" data-section="info">
              <button class="section-title" type="button" data-section-toggle>
                Info
                <span class="section-chevron">▾</span>
              </button>
              <div class="meta-row"><span>Renderer</span><strong id="meta-renderer">-</strong></div>
              <div class="meta-row"><span>Shape</span><strong id="meta-shape">-</strong></div>
              <div class="meta-row"><span>DType</span><strong id="meta-dtype">-</strong></div>
              <div class="meta-row"><span>Range</span><strong id="meta-range">-</strong></div>
            </section>
          </div>

          <div class="panel-tab-content" data-panel-tab="data">
            <section class="panel-section" data-section="data-source" id="data-section">
              <button class="section-title" type="button" data-section-toggle>
                <span class="section-title-main">
                  <span>Data Source</span>
                  <span class="section-summary" id="summary-data-source">File · no file</span>
                </span>
                <span class="section-chevron">▾</span>
              </button>
              <div class="section-state is-empty" id="data-source-state" role="status" aria-live="polite">
                Choose an image source to begin.
              </div>
              <div class="section-skeleton is-hidden" id="data-source-skeleton" aria-hidden="true"></div>
              <label class="field">
                <span>Data Source</span>
                <select id="autoload-mode">
                  <option value="file">File</option>
                  <option value="simplon">SIMPLON Monitor</option>
                  <option value="remote">Remote Stream</option>
                </select>
              </label>
              <div class="autoload-group" id="autoload-folder">
                <label class="field">
                  <span>Folder</span>
                  <div class="inline">
                    <input
                      id="autoload-dir"
                      type="text"
                      list="autoload-dir-list"
                      placeholder="test_data or /abs/path"
                    />
                    <button class="btn btn-secondary" id="autoload-browse" type="button">Browse…</button>
                  </div>
                  <datalist id="autoload-dir-list"></datalist>
                </label>
              </div>
              <label class="field" id="file-field">
                <span>Image File</span>
                <select id="file-select"></select>
              </label>
              <label class="field" id="dataset-field">
                <span>Dataset</span>
                <select id="dataset-select"></select>
              </label>
              <label class="field is-hidden" id="threshold-field">
                <span>Threshold</span>
                <select id="threshold-select"></select>
              </label>
              <details class="advanced-details">
                <summary>Advanced source settings</summary>
                <div class="advanced-inner">
                  <label class="field">
                    <span>File System</span>
                    <select id="filesystem-mode">
                      <option value="remote">Remote Server</option>
                      <option value="local" selected>Local Machine</option>
                    </select>
                  </label>
                  <div class="autoload-group" id="autoload-watch">
                    <label class="checkbox">
                      <input id="autoload-watch-enabled" type="checkbox" />
                      Watch folder
                    </label>
                    <div id="autoload-watch-options">
                      <label class="field">
                        <span>Poll (ms)</span>
                        <input id="autoload-interval" type="number" min="200" step="100" value="1000" />
                      </label>
                      <label class="field">
                        <span>Filename pattern</span>
                        <input id="autoload-pattern" type="text" placeholder="*.h5 or *master*" />
                      </label>
                      <div class="check-row" id="autoload-types">
                        <label class="checkbox">
                          <input id="autoload-type-hdf5" type="checkbox" checked />
                          HDF5
                        </label>
                        <label class="checkbox">
                          <input id="autoload-type-tiff" type="checkbox" checked />
                          TIFF
                        </label>
                        <label class="checkbox">
                          <input id="autoload-type-cbf" type="checkbox" checked />
                          CBF
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="autoload-group is-hidden" id="autoload-simplon">
                    <label class="field">
                      <span>Base URL</span>
                      <input id="simplon-url" type="text" placeholder="http://127.0.0.1:5000" />
                    </label>
                    <label class="checkbox">
                      <input id="simplon-enable" type="checkbox" checked />
                      Enable monitor
                    </label>
                    <label class="field">
                      <span>API Version</span>
                      <input id="simplon-version" type="text" value="1.8.0" />
                    </label>
                    <label class="field">
                      <span>Timeout (ms)</span>
                      <input id="simplon-timeout" type="number" min="100" step="100" value="500" />
                    </label>
                  </div>
                  <div class="autoload-group is-hidden" id="autoload-remote">
                    <label class="field">
                      <span>Source ID</span>
                      <input id="remote-source-id" type="text" value="default" placeholder="default" />
                    </label>
                    <label class="field">
                      <span>Poll (ms)</span>
                      <input id="remote-interval" type="number" min="100" step="100" value="1000" />
                    </label>
                  </div>
                  <div class="autoload-group advanced-status-block">
                    <div class="advanced-status-title">Stream status</div>
                    <div class="autoload-meta">
                      <div class="meta-row"><span>Last poll</span><strong id="autoload-status">-</strong></div>
                      <div class="meta-row"><span>Last image</span><strong id="autoload-latest">-</strong></div>
                    </div>
                    <div class="simplon-meta is-hidden" id="simplon-meta">
                      <div class="meta-row"><span>Series</span><strong id="simplon-series">-</strong></div>
                      <div class="meta-row"><span>Image</span><strong id="simplon-image">-</strong></div>
                      <div class="meta-row"><span>Timestamp</span><strong id="simplon-time">-</strong></div>
                      <div class="meta-row"><span>Energy (eV)</span><strong id="simplon-energy">-</strong></div>
                      <div class="meta-row"><span>Threshold (eV)</span><strong id="simplon-threshold">-</strong></div>
                      <div class="meta-row"><span>Wavelength (Å)</span><strong id="simplon-wavelength">-</strong></div>
                      <div class="meta-row"><span>Distance (mm)</span><strong id="simplon-distance">-</strong></div>
                      <div class="meta-row"><span>Beam center (px)</span><strong id="simplon-center">-</strong></div>
                    </div>
                    <div class="remote-meta is-hidden" id="remote-meta">
                      <div class="meta-row"><span>Source</span><strong id="remote-source">-</strong></div>
                      <div class="meta-row"><span>Sequence</span><strong id="remote-seq">-</strong></div>
                      <div class="meta-row"><span>Series</span><strong id="remote-series">-</strong></div>
                      <div class="meta-row"><span>Image</span><strong id="remote-image">-</strong></div>
                      <div class="meta-row"><span>Timestamp</span><strong id="remote-time">-</strong></div>
                      <div class="meta-row"><span>Energy (eV)</span><strong id="remote-energy">-</strong></div>
                      <div class="meta-row"><span>Wavelength (Å)</span><strong id="remote-wavelength">-</strong></div>
                      <div class="meta-row"><span>Distance (mm)</span><strong id="remote-distance">-</strong></div>
                      <div class="meta-row"><span>Beam center (px)</span><strong id="remote-center">-</strong></div>
                      <div class="meta-row"><span>Peak sets</span><strong id="remote-peak-sets">-</strong></div>
                    </div>
                  </div>
                </div>
              </details>
            </section>
            <section class="panel-section inspector is-collapsed" data-section="inspector">
              <button class="section-title" type="button" data-section-toggle>
                File Inspector
                <span class="section-chevron">▾</span>
              </button>
              <div class="section-state is-empty" id="inspector-state" role="status" aria-live="polite">
                Select an HDF5 file to browse metadata.
              </div>
              <div class="inspector-search">
                <input id="inspector-search-input" type="search" placeholder="Search paths…" />
                <button type="button" id="inspector-search-clear">Clear</button>
              </div>
              <div class="inspector-results is-hidden" id="inspector-results"></div>
              <div class="inspector-tree" id="inspector-tree">
                <div class="inspector-empty">Select an HDF5 file to browse metadata.</div>
              </div>
              <div class="inspector-details" id="inspector-details">
                <div class="meta-row"><span>Path</span><strong id="inspector-path">-</strong></div>
                <div class="meta-row"><span>Type</span><strong id="inspector-type">-</strong></div>
                <div class="meta-row"><span>Shape</span><strong id="inspector-shape">-</strong></div>
                <div class="meta-row"><span>DType</span><strong id="inspector-dtype">-</strong></div>
                <div class="inspector-attrs" id="inspector-attrs"></div>
                <div class="inspector-preview" id="inspector-preview"></div>
              </div>
            </section>
            <section class="panel-section image-header is-hidden is-collapsed" data-section="image-header" id="image-header-section">
              <button class="section-title" type="button" data-section-toggle>
                Image Header
                <span class="section-chevron">▾</span>
              </button>
              <div class="section-state is-empty" id="image-header-state" role="status" aria-live="polite">
                No header available.
              </div>
              <div class="image-header-loading is-hidden" id="image-header-loading" aria-hidden="true"></div>
              <div class="image-header-empty" id="image-header-empty">No header available.</div>
              <pre class="image-header-text" id="image-header-text"></pre>
            </section>
            <section class="panel-section is-collapsed" data-section="series-summing">
              <button class="section-title" type="button" data-section-toggle>
                Series Operations
                <span class="section-chevron">▾</span>
              </button>
              <div class="series-sum-options">
                <label class="field" id="series-sum-mode-field">
                  <span>Mode</span>
                  <select id="series-sum-mode">
                    <option value="all">All frames</option>
                    <option value="step">Chunks of N frames</option>
                    <option value="nth">Every Nth frame</option>
                    <option value="range">Range (start-end in chunks)</option>
                  </select>
                </label>
                <label class="field" id="series-sum-operation-field">
                  <span>Operation</span>
                  <select id="series-sum-operation">
                    <option value="sum">Sum</option>
                    <option value="mean">Mean</option>
                    <option value="median">Median</option>
                  </select>
                </label>
                <label class="field" id="series-sum-format-field">
                  <span>Format</span>
                  <select id="series-sum-format">
                    <option value="hdf5">HDF5</option>
                    <option value="tiff">TIFF</option>
                  </select>
                </label>
                <label class="field" id="series-sum-step-field">
                  <span id="series-sum-step-label">Chunk size (N)</span>
                  <input id="series-sum-step" type="number" min="1" step="1" value="10" />
                  <div class="field-hint is-hidden" id="series-sum-step-hint"></div>
                </label>
                <label class="field is-hidden" id="series-sum-range-start-field">
                  <span>Start frame</span>
                  <input id="series-sum-range-start" type="number" min="1" step="1" value="1" />
                </label>
                <label class="field is-hidden" id="series-sum-range-end-field">
                  <span>End frame</span>
                  <input id="series-sum-range-end" type="number" min="1" step="1" value="1" />
                </label>
                <label class="checkbox series-sum-normalize-option">
                  <input id="series-sum-normalize-enable" type="checkbox" />
                  Normalize by frame
                </label>
                <label class="field is-hidden" id="series-sum-normalize-frame-field">
                  <span>Norm frame</span>
                  <input id="series-sum-normalize-frame" type="number" min="1" step="1" value="1" />
                </label>
                <label class="checkbox series-sum-mask-option">
                  <input id="series-sum-mask" type="checkbox" checked />
                  Apply mask
                </label>
              </div>
              <label class="field">
                <span>Output path</span>
                <div class="inline series-sum-output-row">
                  <input id="series-sum-output" type="text" placeholder="output/series_sum" />
                  <button id="series-sum-browse" class="btn btn-secondary" type="button">Browse…</button>
                </div>
              </label>
              <div class="series-sum-start-row">
                <button id="series-sum-start" class="btn btn-primary" type="button">Start</button>
                <div class="series-sum-progress" id="series-sum-progress">
                  <div class="series-sum-progress-fill" id="series-sum-progress-fill"></div>
                  <div class="series-sum-progress-text" id="series-sum-progress-text">Idle</div>
                </div>
              </div>
            </section>
          </div>

          <div class="panel-tab-content" data-panel-tab="analysis">
            <section class="panel-section" data-section="roi" id="roi-section">
              <button class="section-title" type="button" data-section-toggle>
                <span class="section-title-main">
                  <span>Statistics and ROI</span>
                  <span class="section-summary" id="summary-roi">Image stats</span>
                </span>
                <span class="section-chevron">▾</span>
              </button>
              <div class="section-state is-empty" id="roi-state" role="status" aria-live="polite">
                Load a frame to use ROI tools.
              </div>
              <label class="field">
                <span class="sr-only">Mode</span>
                <select id="roi-mode">
                  <option value="none" selected>None</option>
                  <option value="line">Line ROI</option>
                  <option value="box">Box ROI</option>
                  <option value="circle">Circle ROI</option>
                  <option value="annulus">Annulus ROI</option>
                </select>
              </label>
              <div class="roi-quick-actions">
                <button id="roi-clear-btn" class="btn btn-secondary roi-quick-btn" type="button">Clear ROI</button>
              </div>
              <div class="roi-help" id="roi-help">Right‑drag on the image to define the ROI.</div>
              <div class="roi-params" id="roi-params">
                <div class="roi-center-fields is-hidden" id="roi-center-fields">
                  <label class="roi-mini-field">
                    <span class="roi-mini-label">X</span>
                    <input id="roi-center-x" type="number" min="0" step="1" />
                  </label>
                  <label class="roi-mini-field">
                    <span class="roi-mini-label">Y</span>
                    <input id="roi-center-y" type="number" min="0" step="1" />
                  </label>
                </div>
                <label class="roi-mini-field roi-radius-field is-hidden" id="roi-radius-field">
                  <span class="roi-mini-label">R</span>
                  <input id="roi-radius" type="number" min="0" step="1" />
                </label>
                <div class="roi-ring-fields is-hidden" id="roi-ring-fields">
                  <label class="roi-mini-field">
                    <span class="roi-mini-label">Inner</span>
                    <input id="roi-inner-radius" type="number" min="0" step="1" />
                  </label>
                  <label class="roi-mini-field">
                    <span class="roi-mini-label">Outer</span>
                    <input id="roi-outer-radius" type="number" min="0" step="1" />
                  </label>
                </div>
              </div>
              <div class="roi-stats roi-stats-grid">
                <div class="roi-stats-col">
                  <div class="meta-row"><span>Start (X,Y)</span><strong id="roi-start">-</strong></div>
                  <div class="meta-row"><span>End (X,Y)</span><strong id="roi-end">-</strong></div>
                  <div class="meta-row"><span id="roi-size-label">Size</span><strong id="roi-size">-</strong></div>
                  <div class="meta-row"><span>Total pixels</span><strong id="roi-total">-</strong></div>
                  <div class="meta-row"><span>Gap pixels</span><strong id="roi-gap">-</strong></div>
                  <div class="meta-row"><span>Defective pixels</span><strong id="roi-defective">-</strong></div>
                  <div class="meta-row"><span>Saturated pixels</span><strong id="roi-saturated">-</strong></div>
                </div>
                <div class="roi-stats-col">
                  <div class="meta-row"><span>Min</span><strong id="roi-min">-</strong></div>
                  <div class="meta-row"><span>Max</span><strong id="roi-max">-</strong></div>
                  <div class="meta-row"><span>Sum</span><strong id="roi-sum">-</strong></div>
                  <div class="meta-row"><span>Median</span><strong id="roi-median">-</strong></div>
                  <div class="meta-row"><span>Mean</span><strong id="roi-mean">-</strong></div>
                  <div class="meta-row"><span>Std</span><strong id="roi-std">-</strong></div>
                </div>
              </div>
              <div class="roi-plot-controls" id="roi-plot-controls">
                <label class="checkbox roi-log-toggle">
                  <input id="roi-log" type="checkbox" />
                  Log plot
                </label>
                <label class="checkbox roi-autoscale-toggle">
                  <input id="roi-limits-enable" type="checkbox" checked />
                  Autoscale
                </label>
                <button id="roi-export-csv" class="btn btn-secondary roi-export-btn" type="button">Export CSV</button>
              </div>
              <div class="roi-plots">
                <div class="roi-plot" id="roi-line-plot">
                  <div class="roi-plot-title">Line Profile</div>
                  <canvas id="roi-line-canvas"></canvas>
                  <div class="roi-tooltip" aria-hidden="true"></div>
                  <div class="roi-resize-handle"></div>
                </div>
                <div class="roi-plot" id="roi-box-plot-x">
                  <div class="roi-plot-title">X Projection</div>
                  <canvas id="roi-x-canvas"></canvas>
                  <div class="roi-tooltip" aria-hidden="true"></div>
                  <div class="roi-resize-handle"></div>
                </div>
                <div class="roi-plot" id="roi-box-plot-y">
                  <div class="roi-plot-title">Y Projection</div>
                  <canvas id="roi-y-canvas"></canvas>
                  <div class="roi-tooltip" aria-hidden="true"></div>
                  <div class="roi-resize-handle"></div>
                </div>
              </div>
            </section>
            <section class="panel-section is-collapsed" data-section="resolution-rings">
              <button class="section-title" type="button" data-section-toggle>
                <span class="section-title-main">
                  <label class="section-switch">
                    <input id="rings-toggle" type="checkbox" />
                    <span class="section-switch-track" aria-hidden="true"></span>
                  </label>
                  <span>Resolution Rings</span>
                  <span class="section-summary" id="summary-rings">Off</span>
                </span>
                <span class="section-chevron">▾</span>
              </button>
              <div class="section-state is-empty" id="rings-state" role="status" aria-live="polite">
                Enable rings to show resolution guides.
              </div>
              <details class="advanced-details rings-advanced">
                <summary>Geometry inputs</summary>
                <div class="advanced-inner rings-grid rings-grid-top">
                  <label class="field">
                    <span>Detector distance (mm)</span>
                    <input id="rings-distance" type="number" min="0" step="1" placeholder="e.g. 250" />
                    <div class="field-hint is-hidden" id="rings-distance-hint"></div>
                  </label>
                  <label class="field">
                    <span>Pixel size (µm)</span>
                    <input id="rings-pixel" type="number" min="0" step="0.1" placeholder="e.g. 75" />
                    <div class="field-hint is-hidden" id="rings-pixel-hint"></div>
                  </label>
                  <label class="field">
                    <span>Photon energy (eV)</span>
                    <input id="rings-energy" type="number" min="0" step="1" placeholder="e.g. 12000" />
                    <div class="field-hint is-hidden" id="rings-energy-hint"></div>
                  </label>
                  <label class="field">
                    <span>Beam center (px)</span>
                    <div class="ring-center">
                      <input id="rings-center-x" type="number" step="1" placeholder="X" />
                      <input id="rings-center-y" type="number" step="1" placeholder="Y" />
                    </div>
                  </label>
                </div>
              </details>
              <div class="rings-grid rings-grid-bottom">
                <label class="field rings-values-field">
                  <span>Rings (Å)</span>
                  <div class="ring-values">
                    <input id="ring-r1" type="number" min="0" step="0.1" value="1.0" />
                    <input id="ring-r2" type="number" min="0" step="0.1" value="2.0" />
                    <input id="ring-r3" type="number" min="0" step="0.1" value="4.0" />
                  </div>
                </label>
              </div>
            </section>
            <section class="panel-section is-collapsed" data-section="peak-finder">
              <button class="section-title" type="button" data-section-toggle>
                <span class="section-title-main">
                  <label class="section-switch">
                    <input id="peaks-enable" type="checkbox" />
                    <span class="section-switch-track" aria-hidden="true"></span>
                  </label>
                  <span>Peak Finder</span>
                  <span class="section-summary" id="summary-peaks">Off</span>
                </span>
                <span class="section-chevron">▾</span>
              </button>
              <div class="section-state is-empty" id="peaks-state" role="status" aria-live="polite">
                Enable Peak Finder to detect peaks.
              </div>
              <div class="peaks-controls">
                <label class="field peaks-count-field">
                  <span>Peaks to find</span>
                  <input id="peaks-count" type="number" min="1" max="1000" step="1" value="100" />
                  <div class="field-hint is-hidden" id="peaks-count-hint"></div>
                </label>
                <button id="peaks-export" class="btn btn-secondary" type="button">Export CSV</button>
              </div>
              <div class="peaks-list" id="peaks-list">
                <div class="peaks-head">
                  <span>#</span>
                  <span>X</span>
                  <span>Y</span>
                  <span>Intensity</span>
                </div>
                <div class="peaks-body" id="peaks-body">
                  <div class="peaks-empty">Load a frame to detect peaks.</div>
                </div>
              </div>
            </section>
          </div>

          </div>
        </aside>
      </div>
    </div>



    <input class="file-input" id="file-input" type="file" accept=".h5,.hdf5,.tif,.tiff,.cbf,.cbf.gz,.edf" multiple />
    <div class="modal" id="about-modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-card about-modal-card" role="dialog" aria-modal="true" aria-labelledby="about-title">
        <div class="modal-header">
          <div id="about-title">About ALBIS — ALBIS WEB VIEW</div>
          <button class="modal-close" id="about-close">✕</button>
        </div>
        <div class="modal-body about-modal-body">
          <img class="about-logo" src="ressources/albis_512x512.png" alt="ALBIS logo" />
          <p class="about-lead">
            ALBIS WEB VIEW is a canvas-first image viewer for fast exploration of HDF5 stacks and other detector frames.
          </p>
          <p id="about-version" class="about-version">Version 0.8.1</p>
          <div class="about-facts">
            <div class="about-fact"><span>Author</span><strong>Sascha Grimm</strong></div>
            <div class="about-fact"><span>Rendering</span><strong>WebGL2 + CPU fallback</strong></div>
            <div class="about-fact"><span>Focus</span><strong>Interactive analysis and overlays</strong></div>
            <div class="about-fact"><span>Formats</span><strong>HDF5, TIFF, CBF, EDF</strong></div>
          </div>
          <a class="about-repo-link" href="https://github.com/SaschaAndresGrimm/ALBIS" target="_blank" rel="noopener">
            Open ALBIS on GitHub
          </a>
        </div>
      </div>
    </div>

    <div class="modal" id="settings-modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-card settings-modal-card" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="modal-header">
          <div id="settings-title">Settings</div>
          <button class="modal-close" id="settings-close">✕</button>
        </div>
        <div class="modal-body settings-modal-body">
          <div class="settings-meta">
            <div>Config file: <code id="settings-config-path">-</code></div>
            <div class="settings-hint">Some settings apply after restart.</div>
          </div>
          <div class="settings-sections">
            <section class="settings-section">
              <div class="settings-section-head">
                <h3>Application</h3>
                <p>Backend endpoint and launch behavior.</p>
              </div>
              <div class="settings-grid">
                <label class="field">
                  <span>Host</span>
                  <input id="settings-server-host" type="text" />
                </label>
                <label class="field">
                  <span>Port</span>
                  <input id="settings-server-port" type="number" min="0" max="65535" step="1" />
                </label>
                <label class="field">
                  <span>Startup timeout (s)</span>
                  <input id="settings-startup-timeout" type="number" min="0.1" step="0.1" />
                </label>
                <label class="checkbox settings-check">
                  <input id="settings-server-reload" type="checkbox" />
                  Enable backend reload
                </label>
                <label class="checkbox settings-check">
                  <input id="settings-open-browser" type="checkbox" />
                  Open browser on launch
                </label>
              </div>
            </section>

            <section class="settings-section">
              <div class="settings-section-head">
                <h3>Viewer</h3>
                <p>Interaction hints and pixel label behavior.</p>
              </div>
              <div class="settings-grid">
                <label class="checkbox settings-check settings-span-2">
                  <input id="settings-tool-hints" type="checkbox" />
                  Enable tool hints
                </label>
                <label class="field">
                  <span>Pixel label min cell (px)</span>
                  <input id="settings-pixel-label-min" type="number" min="8" max="64" step="1" />
                </label>
                <label class="field">
                  <span>Pixel labels max/frame</span>
                  <input id="settings-pixel-label-max" type="number" min="100" max="100000" step="100" />
                </label>
                <label class="field">
                  <span>Pixel label format</span>
                  <select id="settings-pixel-label-format">
                    <option value="auto">Auto</option>
                    <option value="integer">Integer</option>
                    <option value="scientific">Scientific</option>
                  </select>
                </label>
                <label class="checkbox settings-check">
                  <input id="settings-pixel-label-drag" type="checkbox" />
                  Draw labels during pan/zoom
                </label>
              </div>
            </section>

            <section class="settings-section">
              <div class="settings-section-head">
                <h3>Data Access</h3>
                <p>File system permissions and scan limits.</p>
              </div>
              <div class="settings-grid">
                <label class="field settings-span-2">
                  <span>Data root</span>
                  <input id="settings-data-root" type="text" />
                </label>
                <label class="checkbox settings-check">
                  <input id="settings-allow-abs" type="checkbox" />
                  Allow absolute paths
                </label>
                <label class="field">
                  <span>Scan cache (s)</span>
                  <input id="settings-scan-cache" type="number" min="0" step="0.1" />
                </label>
                <label class="field">
                  <span>Max scan depth</span>
                  <input id="settings-max-scan-depth" type="number" min="-1" step="1" />
                </label>
                <label class="field">
                  <span>Max upload (MB)</span>
                  <input id="settings-max-upload" type="number" min="0" step="1" />
                </label>
              </div>
            </section>

            <section class="settings-section">
              <div class="settings-section-head">
                <h3>Logging</h3>
                <p>Verbosity and log output location.</p>
              </div>
              <div class="settings-grid">
                <label class="field">
                  <span>Log level</span>
                  <select id="settings-log-level">
                    <option value="DEBUG">DEBUG</option>
                    <option value="INFO">INFO</option>
                    <option value="WARNING">WARNING</option>
                    <option value="ERROR">ERROR</option>
                    <option value="CRITICAL">CRITICAL</option>
                  </select>
                </label>
                <label class="field settings-span-2">
                  <span>Log directory</span>
                  <input id="settings-log-dir" type="text" />
                </label>
              </div>
            </section>
          </div>
          <div class="settings-message" id="settings-message"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="settings-cancel">Cancel</button>
          <button class="btn btn-primary" id="settings-save">Save</button>
          <button class="btn btn-primary" id="settings-save-close">Save &amp; Close</button>
        </div>
      </div>
    </div>

    <div class="modal" id="browse-modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-card browse-modal-card" role="dialog" aria-modal="true" aria-labelledby="browse-title">
        <div class="modal-header">
          <div id="browse-title">Select Folder</div>
          <button class="modal-close" id="browse-close">✕</button>
        </div>
        <div class="modal-body browse-modal-body">
          <div class="browse-breadcrumb" id="browse-breadcrumb">
            <button class="breadcrumb-btn" data-path="">Root</button>
          </div>
          <div class="browse-content">
            <div class="browse-folders">
              <div class="browse-section-title">Folders</div>
              <div class="browse-list" id="browse-folders-list"></div>
            </div>
            <div class="browse-files">
              <div class="browse-section-title">HDF5 Files</div>
              <div class="browse-list" id="browse-files-list"></div>
            </div>
          </div>
          <div class="browse-path">
            <label>
              <span>Path:</span>
              <input id="browse-path-input" type="text" readonly />
            </label>
          </div>
          <div class="browse-status" id="browse-status" aria-live="polite"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="browse-cancel">Cancel</button>
          <button class="btn btn-primary" id="browse-select">Select</button>
        </div>
      </div>
    </div>

    <div class="modal" id="command-modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-card command-modal-card" role="dialog" aria-modal="true" aria-labelledby="command-title">
        <div class="command-header">
          <div id="command-title">Command Palette</div>
          <div class="command-hint">Enter to run • Esc to close</div>
        </div>
        <div class="command-search">
          <input id="command-input" type="search" placeholder="Type a command or shortcut…" autocomplete="off" />
        </div>
        <div class="command-list" id="command-list"></div>
      </div>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
